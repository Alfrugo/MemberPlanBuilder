<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Plan</title>
</head>
<body>
    <h1>Create Plan</h1>
    <form id="createPlanForm">
        <!-- Your form fields here -->
        <input type="text" id="code" name="code" placeholder="Code">
        <input type="text" id="html" name="html" placeholder="HTML">
        <input type="text" id="title" name="title" placeholder="Title">
        <input type="text" id="url" name="url" placeholder="URL">
        <input type="text" id="zipCode" name="zipCode" placeholder="Zip Code">
        <button type="submit">Create Plan</button>
    </form>
    <div id="result"></div>

    <script>
        console.log('script.js loaded');
        document.addEventListener('DOMContentLoaded', async () => {
            // Retrieve the JWT token from local storage
            const jwtToken = localStorage.getItem('jwtToken');
            console.log('jwtToken', jwtToken);

            // If the token is not present, you may choose to handle it (e.g., redirect to login page)
            if (!jwtToken) {
                console.error('JWT token not found. Please log in.');
                return;
            }

            const createPlanForm = document.getElementById('createPlanForm');
            const resultContainer = document.getElementById('result');

            createPlanForm.addEventListener('submit', async (event) => {
                event.preventDefault();

                const code = document.getElementById('code').value;
                const html = document.getElementById('html').value;
                const title = document.getElementById('title').value;
                const url = document.getElementById('url').value;
                const zipCode = document.getElementById('zipCode').value;

                try {
                    const response = await fetch('/createPlan', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            Authorization: `Bearer ${jwtToken}`, // Include the JWT token in the Authorization header
                        },
                        body: JSON.stringify({ Code: code, HTML: html, Title: title, Url: url, ZipCode: zipCode }),
                    });

                    if (!response.ok) {
                        throw new Error(`Failed to create plan: ${response.status} ${response.statusText}`);
                    }

                    const result = await response.json();
                    resultContainer.textContent = result.message;
                } catch (error) {
                    console.error('Error creating plan:', error);
                    resultContainer.textContent = 'Error creating plan. Please try again.';
                }
            });
        });
    </script>
</body>
</html>
